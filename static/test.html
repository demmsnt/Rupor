<html>
	<head>
	</head>
	<body>
		<h1>test</h1>
<div id="subscribe"></div>
<input id="message" />
<button id="submit">Send</button>
<script src="/js/jquery.min.js"></script>
		<script>
$(document).ready(function() {

    var sock = new WebSocket('ws://' + window.location.host + '/ws');

// show message in div#subscribe
function showMessage(message) {
    console.log('message', message);
    var messageElem = $('#subscribe'),
        height = 0,
        date = new Date(message['t']);
        options = {hour12: false};
    messageElem.append($('<p>').html('[' + date.toLocaleTimeString('en-US', options) + '] ' + message['m'] + '\n'));
    messageElem.find('p').each(function(i, value){
        height += parseInt($(this).height());
    });

    messageElem.animate({scrollTop: height});
}

function sendMessage(){
    var msg = $('#message');
    sock.send(msg.val());
    msg.val('').focus();
}

sock.onopen = function(){
    console.log('Connection to server started')
}

// send message from form
$('#submit').click(function() {
	console.log('send');
    sendMessage();
});

$('#message').keyup(function(e){
    if(e.keyCode == 13){
        sendMessage();
    }
});

// income message handler
sock.onmessage = function(event) {
  var message = JSON.parse(event.data);
  showMessage(message);
};

//$('#signout').click(function(){
//    window.location.href = "signout"
//});

sock.onclose = function(event){
    if(event.wasClean){
        console.log('Clean connection end')
    }else{
        console.log('Connection broken')
    }
};

sock.onerror = function(error){
    console.debug(error);
}

});
		</script>
	</body>
</html>